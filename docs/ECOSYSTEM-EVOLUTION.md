# 생태계 진화 시스템 설계

이 문서는 원시 지구에서 현대 생태계까지의 자연스러운 진화 시스템을 설계합니다.

---

## 1. 핵심 원칙

### 하드코딩 금지
- 시대 전환이 타이머나 고정값으로 결정되지 않음
- **AI 생태계의 상태**에 따라 환경이 자연스럽게 변화
- 광합성 생물이 산소를 생산 → 산소 축적 → 동물 생존 가능

### 실제 진화 역사 반영
```
45억 년 전: 지구 형성
38억 년 전: 최초의 생명 (바다에서)
27억 년 전: 시아노박테리아 (광합성 시작)
24억 년 전: 대산화 사건 (산소 축적)
5억 년 전: 캄브리아기 대폭발 (동물 다양화)
4억 년 전: 육지 진출 (식물 → 절지동물 → 양서류)
```

---

## 2. 생명의 시작: 바다

### 2.1 왜 바다에서 시작하는가?
- 자외선 차폐 (물이 보호막 역할)
- 화학 반응에 필요한 용매
- 온도 안정성
- 필수 영양소 용해

### 2.2 초기 생명체 (바다 전용)

#### 식물성 플랑크톤 (Phytoplankton)
```typescript
{
  kingdom: 'plant',
  diet: 'photosynthetic',
  habitat: 'water',        // 물에서만 생존
  locomotion: 'floating',  // 떠다님
  size: 0.2 ~ 0.5,         // 매우 작음
  features: {
    photosynthesis: true,  // 광합성
    oxygenProduction: true // 산소 생산
  }
}
```

#### 동물성 플랑크톤 (Zooplankton)
```typescript
{
  kingdom: 'animal',
  diet: 'herbivore',       // 식물성 플랑크톤을 먹음
  habitat: 'water',        // 물에서만 생존
  locomotion: 'swimming',  // 수영
  size: 0.3 ~ 0.8,
  features: {
    filter_feeding: true   // 여과 섭식
  }
}
```

### 2.3 바다 생태계 먹이사슬
```
☀️ 태양
    ↓
🌿 식물성 플랑크톤 (광합성, 산소 생산)
    ↓
🦐 동물성 플랑크톤 (식물 플랑크톤 섭식)
    ↓
🐟 작은 물고기 (플랑크톤 섭식)
    ↓
🦈 큰 물고기 (작은 물고기 포식)
```

---

## 3. 서식지 시스템 (Habitat)

### 3.1 서식지 타입
```typescript
type HabitatType =
  | 'water'      // 물 (바다, 호수)
  | 'land'       // 육지
  | 'amphibious' // 양서 (물 + 육지 경계)
  | 'any';       // 제한 없음
```

### 3.2 서식지와 생존
| 서식지 | 물에서 | 육지에서 |
|--------|--------|----------|
| water | ✅ 생존 | ❌ 즉사 (건조) |
| land | ❌ 익사 | ✅ 생존 |
| amphibious | ✅ 생존 | ⚠️ 제한적 생존 |

### 3.3 지형과 서식지 매핑
```typescript
// BiomeType → 서식지
const BIOME_HABITAT: Record<BiomeType, HabitatType> = {
  DEEP_WATER: 'water',
  SHALLOW_WATER: 'water',
  BEACH: 'amphibious',  // 해변은 양서 가능
  GRASSLAND: 'land',
  FOREST: 'land',
  DESERT: 'land',
  MOUNTAIN: 'land',
};
```

---

## 4. 육지 진출 (Land Colonization)

### 4.1 진화 조건
육지 진출은 다음 조건이 충족되어야 가능:

1. **산소 농도 15% 이상** - 육지에서 호흡하려면 높은 산소 필요
2. **오존층 형성** - 자외선 차폐 (산소 → 오존)
3. **육상 식물 먼저** - 먹이 사슬 기반 필요
4. **개체의 유전적 적응** - amphibious 형질 획득

### 4.2 진화 순서 (실제 역사 기반)
```
1. 🌿 육상 식물 진출 (4.7억 년 전)
   - 이끼, 양치류
   - 육지에서 광합성

2. 🦂 절지동물 진출 (4.3억 년 전)
   - 전갈, 거미, 곤충
   - 외골격으로 건조 방지

3. 🐸 양서류 진출 (3.7억 년 전)
   - 물과 육지 오가며 생활
   - 피부 호흡 + 폐 호흡

4. 🦎 파충류 (3억 년 전)
   - 완전한 육상 생활
   - 알껍질로 건조 방지
```

### 4.3 육지 진출 유전자
```typescript
interface AmphibiousTraits {
  // 건조 저항 (0~1)
  desiccationResistance: number;

  // 폐 호흡 능력 (0~1)
  lungCapacity: number;

  // 다리 발달 (0~1)
  limbDevelopment: number;

  // 육지 적응도 (계산됨)
  landAdaptation: number; // = (위 3개의 평균)
}
```

### 4.4 진화 메커니즘
```typescript
// 해변(amphibious 지역)에서 번식 시:
if (parent.habitat === 'water' && biome === 'BEACH') {
  // 낮은 확률로 양서 형질 획득
  if (Math.random() < 0.01) {
    child.desiccationResistance += 0.1;
    child.lungCapacity += 0.1;
    child.limbDevelopment += 0.1;
  }
}

// 양서 형질이 충분하면 habitat 변경
if (organism.landAdaptation > 0.5) {
  organism.habitat = 'amphibious';
}

if (organism.landAdaptation > 0.8) {
  organism.habitat = 'land';
}
```

---

## 5. 구현 계획

### Phase 1: 기반 시스템
- [ ] `habitat` 속성을 Genome에 추가
- [ ] 지형 타일에서 서식지 확인 함수
- [ ] 서식지 불일치 시 사망 로직

### Phase 2: 바다 생태계
- [ ] 초기 스폰을 물 타일에서만
- [ ] 식물성 플랑크톤 스폰 (광합성)
- [ ] 동물성 플랑크톤 스폰 (산소 충분 시)

### Phase 3: 육지 진출
- [ ] 양서 형질 유전자 추가
- [ ] 해변에서의 돌연변이 확률 증가
- [ ] 육상 식물 진화 조건
- [ ] 육상 동물 진화 조건

### Phase 4: 생태계 균형
- [ ] 각 서식지별 개체 수 제한
- [ ] 서식지 간 이동 AI
- [ ] 포식자-피식자 균형

---

## 6. UI 표시

### 환경 정보 패널 추가
```
🌍 원생누대 | O₂: 5.2%

서식지 분포:
  🌊 바다: 342 (식물: 280, 동물: 62)
  🏖️ 해변: 15 (양서류)
  🌿 육지: 0 (아직 진출 못함)

진화 마일스톤:
  ✅ 최초의 생명
  ✅ 광합성 시작
  ✅ 대산화 사건
  ⬜ 육상 식물 진출
  ⬜ 육상 동물 진출
```

---

## 7. 기술적 고려사항

### 성능 최적화
- 서식지 체크는 공간 해시로 최적화
- 매 프레임이 아닌 500ms 간격으로 체크

### 시각적 피드백
- 물 생물: 파란 계열 외형
- 육지 생물: 녹색/갈색 계열
- 양서류: 청록색 계열

### 저장/불러오기
- habitat 속성 직렬화 포함
- 마일스톤 상태 저장

---

## 8. 예상 결과

시뮬레이션 시작 후:

1. **0~1,000틱**: 바다에서 식물성 플랑크톤 번성
2. **1,000~5,000틱**: 산소 축적, 동물성 플랑크톤 등장
3. **5,000~10,000틱**: 산소 10%+, 다양한 바다 생물
4. **10,000~20,000틱**: 산소 15%+, 해변에서 양서 진화 시도
5. **20,000틱+**: 육지 진출, 완전한 생태계

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2025-11-29 | 초안 작성 |
